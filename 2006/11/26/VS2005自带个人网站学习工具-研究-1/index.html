<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">


























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=6.7.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.jpg?v=6.7.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.jpg?v=6.7.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.jpg?v=6.7.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.7.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '6.7.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="vs2005自带了一个所谓”个人网站初学者学习工具”(简称tool了~),实质上这是个个人网站的建站系统,而它虽然不大,却已经包含了绝大多数.net 2.0的新特性,masterpage theme datasouce membership等等….在现在看petshop程序还是一头雾水的水平下,学习这个显然是明智的选择 呵呵 新建一个”个人网站学习工具”网站,按要求运行,系统会初始化数据库,按照提">
<meta property="og:type" content="article">
<meta property="og:title" content="VS2005自带个人网站学习工具~研究 (1)">
<meta property="og:url" content="http://bobyuxinyang.com/2006/11/26/VS2005自带个人网站学习工具-研究-1/index.html">
<meta property="og:site_name" content="Bob&#39;s log">
<meta property="og:description" content="vs2005自带了一个所谓”个人网站初学者学习工具”(简称tool了~),实质上这是个个人网站的建站系统,而它虽然不大,却已经包含了绝大多数.net 2.0的新特性,masterpage theme datasouce membership等等….在现在看petshop程序还是一头雾水的水平下,学习这个显然是明智的选择 呵呵 新建一个”个人网站学习工具”网站,按要求运行,系统会初始化数据库,按照提">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-03-13T05:48:09.916Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="VS2005自带个人网站学习工具~研究 (1)">
<meta name="twitter:description" content="vs2005自带了一个所谓”个人网站初学者学习工具”(简称tool了~),实质上这是个个人网站的建站系统,而它虽然不大,却已经包含了绝大多数.net 2.0的新特性,masterpage theme datasouce membership等等….在现在看petshop程序还是一头雾水的水平下,学习这个显然是明智的选择 呵呵 新建一个”个人网站学习工具”网站,按要求运行,系统会初始化数据库,按照提">






  <link rel="canonical" href="http://bobyuxinyang.com/2006/11/26/VS2005自带个人网站学习工具-研究-1/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>VS2005自带个人网站学习工具~研究 (1) | Bob's log</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Bob's log</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://bobyuxinyang.com/2006/11/26/VS2005自带个人网站学习工具-研究-1/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="bobyuxiyang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Bob's log">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">VS2005自带个人网站学习工具~研究 (1)

              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2006-11-26 00:00:00" itemprop="dateCreated datePublished" datetime="2006-11-26T00:00:00+08:00">2006-11-26</time>
            

            
              

              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>vs2005自带了一个所谓”个人网站初学者学习工具”(简称tool了~),实质上这是个个人网站的建站系统,而它虽然不大,却已经包含了绝大多数.net 2.0的新特性,masterpage theme</p>
<p>datasouce membership等等….在现在看petshop程序还是一头雾水的水平下,学习这个显然是明智的选择 呵呵</p>
<p>新建一个”个人网站学习工具”网站,按要求运行,系统会初始化数据库,按照提示在asp.net网站配置里建一个administrator帐户,就可以开始玩了</p>
<p>首先看看网站大体结构:<br>主页-&gt;简历 链接 相册 这个是网站主要功能 其实最主要的就是一个相册!<br>另外提供一个 注册 和几个管理页面<br>管理页面都放在admin目录中</p>
<p>从web.config入手~<br>第一次接触这个,感觉一切都很新鲜(废话~),,先看看网站的配置文件吧<br>在教程里看到,系统里有一个web.config的模板,里面很详细,但是也很麻烦,头次看很难明白~<br>这个tool里面的就好懂得多,下面开始分析:</p>
<p>首先是connectionstring<br>定义了两个connectionstring 一个是personal一个是localsqlserver<br>personal里面定义的是网站需要存储的东西,主要是相册和photo<br>而localsqlserver,就是用.net自带的一些服务所需要的数据库~他这里默认是在app_data下的一个文件,这个文件实质上也是一个数据库了,和上面没什么不同,只是对这个数据库的<br>(有时候不能运行和这个有关系)</p>
<p>很多操作都可以用现成的方法完成,比如成员服务 个性化信息服务等等,因为访问细节不需要来关心,因此连provider都不用指定,,,初学情况下用默认的就行了<br>还有一句<remove name="localsqlserver">,这个是用来覆盖掉继承的来自上一级的localsqlserver的~上一级的定义在服务器上会有,是给没有web.config的网站用的默认配置</remove></p>
<p>,在win目录下</p>
<p><pages stylesheettheme="white"> 因此网站的默认theme就是white了,主题里包括default.css 系统会自动应用,因此不用每一页链接default.css</pages></p>
<customerrors mode="remoteonly"> 这一句是定义出错显示的东西,顾名思义就是用服务器的出错信息<br>mode可以改为off 或者 on 自定义出错页面 参考这个用法<br><customerrors defaultredirect="http://hostname/applicationname/errorstatus.htm" mode="on"><br> <error statuscode="404" redirect="filenotfound.htm"><br></error></customerrors>

<p><compilation debug="true"> 可以调试~第一次调试运行弹出的对话框就是说的这个了</compilation></p>
<p>然后定义身份验证是forms 基于窗体 具体的先不谈(下面都这样,具体的都先不谈)\</p>
<p>&lt;globalization一句 定义编码~</p>
<p>然后打开role管理服务<br>打开sitemaps服务,并且设置</p>
<p>然后还定义了一个path 叫admin,也就是admin文件存放的目录,并且指定administrators role可以访问 其他都不行 也就是后台了<br>就这些了</p>
<p>开始分析每个文件前,先看看网站的前台架构<br>整个网站都基于了default.master,这个master定义了页头和页角,用了sitemap,实际上所有的导航都是基于sitemap的,因此可以方便的扩展~用了两个menu和一个sitemappath,</p>
<p>样式控制都用css~<br>对了插一句,整个网站全部基于div+css<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line">首页提供了登陆和每日照片</span><br><span class="line">简历和链接比较基本,没有用到什么技术,就是两个普通页面~</span><br><span class="line">照片提供了一个相册功能,albums.aspx列出了所有相册,通过handler.ashx?albumid=1&amp;size=m访问相册~这里用了httphandle实际上是photos.aspx?alumniid=**</span><br><span class="line">然后photos.aspx根据alumniid列出照片,点击在通过http://localhost:7301/website2/handler.ashx?photoid=1&amp;size=s访问(和上面一样 实质上是</span><br><span class="line"></span><br><span class="line">http://localhost:7301/website2/details.aspx?albumid=1&amp;page=1)</span><br><span class="line">注意一下,这里通过httphandle提供了类似一个照片缩略图的功能</span><br><span class="line"></span><br><span class="line">还有一块儿就是管理功能,这里提供了创建相册,上传图片等等</span><br><span class="line"></span><br><span class="line">不深入了 先开始default.aspx</span><br><span class="line"></span><br><span class="line">右边都是静态页面,没什么可研究的,看左边</span><br><span class="line">上面是一块loginarea,是一个loginview控件</span><br><span class="line">定义了两个模板,&lt;anonymoustemplate&gt; 和 &lt;loggedintemplate&gt; 很好理解</span><br><span class="line">(设计membership的东西,暂时先不写 做个标记..............)</span><br><span class="line"></span><br><span class="line">左边的下面一块formview</span><br><span class="line">只用了一个itemtemplate 实际上显示数据用的</span><br><span class="line">绑定到objectdatasoure</span><br><span class="line">绑定了几个值,</span><br><span class="line">照片链接为 details.aspx?albumid=&lt;%# eval(&quot;albumid&quot;) %&gt;&amp;page=&lt;%# container.dataitemindex %&gt;</span><br><span class="line">照片的src为 handler.ashx?photoid=&lt;%# eval(&quot;photoid&quot;) %&gt;&amp;size=m</span><br><span class="line">照片编号为 &lt;%# eval(&quot;photoid&quot;) %&gt;</span><br><span class="line">先看看objectdatasource里的东西</span><br><span class="line">业务逻辑类是photomanage 只用了一个getphotos方法为selectmethod</span><br><span class="line">去找到这个getphotos (有好几个,这里当然是没有参数的那一个)</span><br><span class="line">getphotos的代码,先随机得到一个alblumid,然后调用哪个需要传入albumid的getphotos</span><br><span class="line"></span><br><span class="line">getphotos函数: 这个直接用了ado.net访问personal数据库,它返回一个list&lt;photo&gt;,,其实就是一个很多个photo类组成的集合</span><br><span class="line">也就是,getphotos 就是返回这个album里面所有的photo 放在一个集合里面,看看它是怎么工作的</span><br><span class="line">通过sqlcommand调用了 getphotos 存储过程,传入的参数有@albumid和@ispublic</span><br><span class="line">@albumid是传入的,@ispublic传入一个bool值,这个值通过当前用户是否在friends或者administrators组得到,在admin组或者在friends组就是false (这个@ispublic意思是&quot;访问</span><br><span class="line"></span><br><span class="line">者是public&quot;)</span><br><span class="line">通过datareader读出,然后写进list&lt;photo&gt; 三个字段(其实是photo类的属性),photoid,albumid,和caption</span><br><span class="line">最后返回list</span><br><span class="line">这里要看一下getphotos存储过程要完成些什么</span><br><span class="line">选出photos,photo的albumid为传入参数,同时此photo对应album的ispublic为1或者对应album的ispublic与传入相同(即要么图片公开,要么图片不公开但是传入的参数是false,</span><br><span class="line"></span><br><span class="line">也就是在admin或者friends组)</span><br><span class="line"> select *</span><br><span class="line"> from [photos] left join [albums]</span><br><span class="line"> on [albums].[albumid] = [photos].[albumid]</span><br><span class="line"> where [photos].[albumid] = @albumid</span><br><span class="line"> and ([albums].[ispublic] = @ispublic or [albums].[ispublic] = 1)</span><br><span class="line">返回的应该是n条数 每条数据包含一条图片信息~包括binary</span><br><span class="line"></span><br><span class="line">回到getphotos函数,list&lt;photo&gt;包含3个字段,photoid albumid caption</span><br><span class="line">顺便再看一下photo类,这个是所谓的&quot;业务实体&quot;</span><br><span class="line">这个在photo.cs里 相当简单,给了三个属性,就是上面那三个,并不包含图像的二进制数据,只是存储了几个id和描述</span><br><span class="line"></span><br><span class="line">还漏了一个,随机得到一个alblumid用的函数getrandomalbumid()</span><br><span class="line">选出非空的album 加入list,随机一个最大为list.count的数,取albumid~sql存储过程里还是有一不少技巧的~</span><br><span class="line"></span><br><span class="line">这部分的绑定差不多就这样了~</span><br><span class="line">下面解决两个问题,注意到,img的src指向那个文件,和page指向的那个&lt;%# container.dataitemindex %&gt;</span><br><span class="line">1 &lt;%# container.dataitemindex %&gt;</span><br><span class="line">container 顾名思义这里表示formview dataitemindex表示formview的数据项,也就是表示第几项数据,绑定的时候,是绑定在一个list&lt;photo&gt;上的,里面包含若干条photo数据,</span><br><span class="line"></span><br><span class="line">具体显示哪一项是随机的</span><br><span class="line">注意到formview属性里 ondatabound=&quot;randomize&quot; randomize方法代码里随机指定了fromview的pageindex,当前的页自然就能通过dataitemindex得到~</span><br><span class="line"></span><br><span class="line">2 关于handler.ashx?photoid=&lt;%# eval(&quot;photoid&quot;) %&gt;&amp;size=m</span><br><span class="line">这个东西实现的是传入photoid和size 就返回一个图片,类似直接输入jpg的url一样~理解起来似乎要麻烦一点(不过很有用,特别是到ajax~)</span><br><span class="line">有个东西里面介绍这个,http://msdn.microsoft.com/msdnmag/issues/02/09/httppipelines/</span><br><span class="line">这个比较复杂,慢慢来 详细看看这个东西</span><br><span class="line">要理解这个,首先需要了解一些http pipelines的东西,一个http请求发出,会有一段httpcontext,细节不关心,这个请求中间会经过一个http handlers的环节,这个环节会对请求的</span><br><span class="line"></span><br><span class="line">文件进行处理,比如标准的http handler中有一条,对于扩展名为.aspx的文件,会调用system.web.ui.pagehandlerfactory来处理,也就是把其当成一个页面,对于.asmx文件,会调用</span><br><span class="line"></span><br><span class="line">webservice的factory来处理,所以服务器认识这些文件(默认设置在本机machine.config和web.config中 win目录下那两个)</span><br><span class="line">关注的是对于.ashx文件,它会调用system.web.ui.simplehandlerfactory</span><br><span class="line">这个factory没有任何实现,当然就等我们去实现了~</span><br><span class="line">还是先不关心细节,实现的方法就是在.ashx文件里加入&lt;%@ webhandler language=&quot;c#&quot; class=&quot;handler&quot; %&gt; 然后实现一个接口ihttphandler</span><br><span class="line">里面只有两个成员isreusable和processrequest</span><br><span class="line">msdn里还看到一种,在任意文件中实现ihttphandler接口,然后在web.config里面加入单独声明 </span><br><span class="line">&lt;httphandlers&gt;</span><br><span class="line"> &lt;add verb=&quot;*&quot; path=&quot;handler.aspx&quot; type=&quot;handlerexample.myhttphandler,handlertest&quot;/&gt;</span><br><span class="line">&lt;/httphandlers&gt;</span><br><span class="line">实际上是把handler.aspx的handler定位到handlertest.dll文件的handlerexample.myhttphandler上,只要运行handler.aspx就会被handle</span><br><span class="line">而用.ashx做法应该是这样 默认.ashx文件是定位到simplehandlerfactory,这个类没有实现但是可继承,加入&lt;%@ webhandler language=&quot;c#&quot; class=&quot;handler&quot; %&gt;就继承了</span><br><span class="line"></span><br><span class="line">这个类到本文件下面的handler类...然后实现handler类即可,因此访问此.ashx文件就会用本文件的handler类来处理,不会影响其他的.ashx文件</span><br><span class="line">isreusable是一个只读属性,返回true就行,否则其他实例无法调用(实际上这里其他实例不可能调用得到,因为继承和实现都在一个地方</span><br><span class="line">processrequest()方法就是主要的实现了,由一个httpcontent参数,当然表示当前的httpcontent了</span><br><span class="line">看程序:</span><br><span class="line">设置content 因为需要把传入的content变成一个图片,所以做一些处理</span><br><span class="line">然后获取传入的数据,先得到size值,然后得到photoid,不存在就用albumid,不论如何用photomanager里的getphoto或者getfirstphoto获取照片的二进制数据,放在一个stream</span><br><span class="line"></span><br><span class="line">里,确保stream里有数据后,写如httpcontent 这段代码:</span><br><span class="line"> // 将图像流写入响应流中</span><br><span class="line"> const int buffersize = 1024 * 16;</span><br><span class="line"> byte[] buffer = new byte[buffersize];</span><br><span class="line"> int count = stream.read(buffer, 0, buffersize);</span><br><span class="line"> while (count &gt; 0) &#123;</span><br><span class="line"> context.response.outputstream.write(buffer, 0, count);</span><br><span class="line"> count = stream.read(buffer, 0, buffersize);</span><br><span class="line"> &#125;</span><br><span class="line">这样context被改变了,于是返回的时候就会返回stream,前面设置过类型是 image/jpeg 于是就相当于jpg文件了~</span><br><span class="line">加一个 得注意context.response属性的设置,具体的还得再研究~</span><br><span class="line"></span><br><span class="line">还差一个,再去看看getphoto和getfirstphoto做了些什么(其实就是根据参数返回数据库中的binary)</span><br><span class="line">getphoto 如果没有传入photoid,也就是httpcontent中没有传入photoid,直接按照size返回现成的jpg,实质就3句话</span><br><span class="line"> string path = httpcontext.current.server.mappath(&quot;~/images/&quot;);</span><br><span class="line"> path += &quot;placeholder-600.jpg&quot;;</span><br><span class="line"> return new filestream(path, filemode.open, fileaccess.read, fileshare.read);</span><br><span class="line">如果传入了photoid,就运行&quot;getphoto&quot;存储过程,返回的代码在这里~图片大小居然写在存储过程里了,传一个参数就行</span><br><span class="line"> object result = command.executescalar();</span><br><span class="line"> try &#123;</span><br><span class="line"> return new memorystream((byte[])result);</span><br><span class="line"> &#125; catch &#123;</span><br><span class="line"> return null;</span><br><span class="line"> &#125;</span><br><span class="line">再看看存储过程,其实很简单,存储图片的时候就分别存储了4中不同size的图片,选的时候用就行了~所以说存储过程可以做不少事情........</span><br><span class="line"></span><br><span class="line">然后getfirstphoto 这个是从album中获取图片，其实差不多，存储过程不一样 本来是where photoid=@photoid现在成了albumid=@albumid 然后加个top 1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">这就是数据库读取图片的实现~~~</span><br></pre></td></tr></table></figure></p>
<p>到这里default.aspx研究的差不多了，在研究到admin之前后面工作会轻松一些</p>
<p>注:photomanager.cs的内容穿插其中了,没有分开写</p>
</customerrors>
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2006/11/08/C-笔记7/" rel="next" title="C#笔记7">
                <i class="fa fa-chevron-left"></i> C#笔记7
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2006/11/27/写了篇文章-骂了些人/" rel="prev" title="写了篇文章,骂了些人....">
                写了篇文章,骂了些人.... <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">bobyuxiyang</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">324</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">3</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:bob.yuxinyang@gmail.com" title="E-Mail &rarr; mailto:bob.yuxinyang@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">bobyuxiyang</span>

  

  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v6.7.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=6.7.0"></script>

  <script src="/js/src/motion.js?v=6.7.0"></script>



  
  


  <script src="/js/src/affix.js?v=6.7.0"></script>

  <script src="/js/src/schemes/pisces.js?v=6.7.0"></script>



  
  <script src="/js/src/scrollspy.js?v=6.7.0"></script>
<script src="/js/src/post-details.js?v=6.7.0"></script>



  


  <script src="/js/src/bootstrap.js?v=6.7.0"></script>



  


  


  





  

  

  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>


  

  

  

  

  

  

  

  

  

  

</body>
</html>
